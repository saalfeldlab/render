{
  "multiStack": {
    "baseDataUrl": "http://10.40.3.113:8080/render-ws/v1",
    "owner": "cellmap",
    "project": "jrc_hum_airway_14953vc",
    "stackIdWithZ": {
      "zValuesPerBatch": 1
    },
    "deriveMatchCollectionNamesFromProject": true
  },
  "pipelineStackGroups": {
    "raw": {
      "stackPattern": "^v1_acquire$"
    },
    "aligned": {
      "stackPattern": "^v1_acquire_align$"
    },
    "intensityCorrected": {
      "stackPattern": "^c.*_ic$"
    }
  },
  "pipelineSteps": [
    "DERIVE_TILE_MATCHES",
    "FIND_UNCONNECTED_TILES_AND_EDGES",
    "ALIGN_TILES",
    "DERIVE_Z_SPACING"
  ],
  "matchRunList": [
    {
      "runName": "montageTopBottomRun",
      "matchCommon": {
        "maxPairsPerStackBatch": 30,
        "featureStorage": {
          "maxFeatureSourceCacheGb": 6
        },
        "maxPeakCacheGb": 2
      },
      "tilePairDerivationParameters": {
        "xyNeighborFactor": 0.6,
        "useRowColPositions": false,
        "zNeighborDistance": 0,
        "excludeCornerNeighbors": true,
        "excludeCompletelyObscuredTiles": false,
        "excludeSameLayerNeighbors": false,
        "excludeSameSectionNeighbors": false,
        "excludePairsInMatchCollection": "pairsFromPriorRuns",
        "excludeSameLayerPairsWithPosition": "LEFT",
        "minExistingMatchCount": 0
      },
      "matchStageParametersList": [
        {
          "stageName": "montageTopBottomPass1",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.25,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 5.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 25,
            "matchModelType": "TRANSLATION",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.2,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "featureRenderClip": {
            "clipHeight": 300,
            "clipWidth": 200
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          }
        },
        {
          "stageName": "montageTopBottomPass2",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.25,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 5.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 12,
            "matchModelType": "TRANSLATION",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.4,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "featureRenderClip": {
            "clipHeight": 300,
            "clipWidth": 200
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          }
        }
      ]
    },
    {
      "runName": "montageLeftRightRun",
      "matchCommon": {
        "maxPairsPerStackBatch": 30,
        "featureStorage": {
          "maxFeatureSourceCacheGb": 6
        },
        "maxPeakCacheGb": 2
      },
      "tilePairDerivationParameters": {
        "xyNeighborFactor": 0.6,
        "useRowColPositions": false,
        "zNeighborDistance": 0,
        "excludeCornerNeighbors": true,
        "excludeCompletelyObscuredTiles": false,
        "excludeSameLayerNeighbors": false,
        "excludeSameSectionNeighbors": false,
        "excludePairsInMatchCollection": "pairsFromPriorRuns",
        "excludeSameLayerPairsWithPosition": "TOP",
        "minExistingMatchCount": 0
      },
      "matchStageParametersList": [
        {
          "stageName": "montageLeftRightPass1",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.25,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 5.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 25,
            "matchModelType": "TRANSLATION",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.8,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "featureRenderClip": {
            "clipHeight": 300,
            "clipWidth": 200
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          }
        },
        {
          "stageName": "montageLeftRightPass2",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.25,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 5.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 6,
            "matchModelType": "TRANSLATION",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 1.0,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "featureRenderClip": {
            "clipHeight": 300,
            "clipWidth": 200
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          }
        }
      ]
    },
    {
      "runName": "crossRun",
      "matchCommon": {
        "maxPairsPerStackBatch": 60,
        "featureStorage": {
          "maxFeatureSourceCacheGb": 6
        },
        "maxPeakCacheGb": 2
      },
      "tilePairDerivationParameters": {
        "xyNeighborFactor": 0.1,
        "useRowColPositions": false,
        "zNeighborDistance": 6,
        "excludeCornerNeighbors": true,
        "excludeCompletelyObscuredTiles": false,
        "excludeSameLayerNeighbors": true,
        "excludeSameSectionNeighbors": true,
        "excludePairsInMatchCollection": "pairsFromPriorRuns",
        "minExistingMatchCount": 0
      },
      "matchStageParametersList": [
        {
          "stageName": "crossPass1",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.125,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 10.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 20,
            "matchModelType": "RIGID",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.05,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          },
          "maxNeighborDistance": 6
        },
        {
          "stageName": "crossPass2",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.125,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 10.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 20,
            "matchModelType": "RIGID",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.1,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          },
          "maxNeighborDistance": 6
        },
        {
          "stageName": "crossPass3",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.125,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 10.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 20,
            "matchModelType": "RIGID",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.2,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          },
          "maxNeighborDistance": 3
        },
        {
          "stageName": "crossPass4",
          "featureExtraction": {
            "fdSize": 4,
            "maxScale": 1.0,
            "minScale": 0.125,
            "steps": 5
          },
          "featureMatchDerivation": {
            "matchFilter": "SINGLE_SET",
            "matchFullScaleCoverageRadius": 300.0,
            "matchIterations": 1000,
            "matchMaxEpsilonFullScale": 10.0,
            "matchMaxTrust": 4.0,
            "matchMinCoveragePercentage": 0.0,
            "matchMinInlierRatio": 0.0,
            "matchMinNumInliers": 10,
            "matchModelType": "RIGID",
            "matchRod": 0.92
          },
          "featureRender": {
            "renderScale": 0.3,
            "renderWithFilter": false,
            "renderWithoutMask": false
          },
          "geometricDescriptorAndMatch": {
            "gdEnabled": false
          },
          "maxNeighborDistance": 2
        }
      ]
    }
  ],
  "tileCluster": {
    "maxLayersPerBatch": 1000,
    "maxOverlapLayers": 10,
    "includeMatchesOutsideGroup": true,
    "maxLayersForUnconnectedEdge": 50
  },
  "affineBlockSolverSetup": {
    "distributedSolve": {
      "maxAllowedErrorGlobal": 10.0,
      "maxIterationsGlobal": 10000,
      "maxPlateauWidthGlobal": 50,
      "deriveThreadsUsingSparkConfig": true
    },
    "targetStack": {
      "stackSuffix": "_align",
      "completeStack": true
    },
    "matches": {
      "matchCollection": "jrc_hum_airway_14953vc_match"
    },
    "blockPartition": {
      "sizeZ": 100
    },
    "stitching": {
      "minInliers": 1000000
    },
    "blockOptimizer": {
      "lambdasRigid": [1.0, 1.0, 0.9, 0.3, 0.01],
      "lambdasTranslation": [1.0, 0.0, 0.0, 0.0, 0.0],
      "lambdasRegularization": [0.0, 0.0, 0.0, 0.0, 0.0],
      "iterations": [1000, 1000, 500, 250, 250],
      "maxPlateauWidth": [250, 250, 150, 100, 100]
    },
    "maxNumMatches": 0,
    "alternatingRuns": {
      "nRuns": 4,
      "keepIntermediateStacks": false
    }
  },
  "zSpacing": {
    "scale": 0.22,
    "rootDirectory": "/nrs/cellmap/data/jrc_hum-airway-14953vc/z_corr",
    "runName": "run01",
    "nLocalEstimates": 1,
    "resin": {
      "resinMaskingEnabled": true,
      "resinSigma": 100,
      "resinContentThreshold": 3.0,
      "resinMaskIntensity": 255.0
    },
    "inferenceOptions": {
      "scalingFactorRegularizerWeight" : 0.1,
      "coordinateUpdateRegularizerWeight" : 0.0,
      "shiftProportion" : 0.6,
      "nIterations" : 100,
      "comparisonRange" : 10,
      "minimumSectionThickness" : 1.0E-4,
      "regularizationType" : "BORDER",
      "scalingFactorEstimationIterations" : 10,
      "withReorder" : false,
      "forceMonotonicity" : false,
      "estimateWindowRadius" : -1,
      "minimumCorrelationValue" : 0.0
    }
  }
}